---
name: 编辑
---

import { Playground, Props } from "docz";
import Table, { flatten } from "tablex";
import { Input, InputNumber, Select, DatePicker, Switch, Checkbox,Button } from "antd";
import 'antd/dist/antd.css';

import Complex from "./complex";
import CustomEdit from "./customEdit";
import Search from "./Search"


# 用法示例

```javascript
import Table, { flatten, unflatten } from "tablex";
```

## 基本编辑及验证

> 编辑有追加模式、非追加模式两种，通过isAppend=true|false 控制，追加模式不会更改当前表格视图的显示数据，否则将会清空当前表格数据视图（不影响数据）

<Playground style={{ height: 400 }}>
 {
  class Demo extends React.Component {
  generateData(columns, count = 20, prefix = "Row") {
    return new Array(count).fill(0).map((row, rowIndex) => {
      return columns.reduce(
        (rowData, column, columnIndex) => {
          if (column.dataIndex !== "id") {
            rowData[column.dataIndex] = Math.floor(Math.random() * 100 + 1);
          } else {
            rowData[column.dataIndex] =
              prefix + " " + rowIndex + " - Col " + columnIndex;
          }

          return rowData;
        },
        {
          id: prefix + rowIndex,
          parentId: null
        }
      );
    });

}

constructor(props) {
super(props);

    const columns = [
      {
        dataIndex: "id",
        title: "id",
        key: "id",
        width: 150
      },
      {
        dataIndex: "column-1",
        title: "column-1",
        width: 100,
          validator: function(value, row) {
          if (!value) {
            return { valid: false, message: "请输入" };
          }

          return { valid: true, message: "false" };
        },
        editor: function(value, row, index, onchange, ref) {
          return (
            <Search
            allowClear
              defaultValue={"1"}
              ref={ref}
              placeholder="请输入"
              onChange={e => onchange({ ["column-1"]: value })}
            />
          );
        }
      },

      {
        dataIndex: "column-2",
        title: "column-2",
        width: 150,
        align: "center",
        editor: function(value, row, index, onchange, ref) {
          return (
            <InputNumber
              defaultValue={value}
              ref={ref}
              onChange={e => onchange({ ["column-2"]: e })}
            />
          );
        }
      },
      {
        dataIndex: "column-3",
        title: "column-3",
        align: "right",
        editor: function(value, row, index, onchange, ref) {
          return (
            <Select
              defaultValue={value}
              ref={ref}
            
            />
          );
        }
      },
      {
        dataIndex: "column-4",
        title: "column-4",
        width: 100,
        align: "center"
      }
    ];

    let data =  this.generateData(columns,10);

     data[1].children =  this.generateData(columns,3,"children-");


    this.state = {
      data: data,
      columns: columns
    };

}

onEditSave(changedRows, newData, type) {
console.log("onEditSave:", newData);

return new Promise((resolve,reject)=>{

setTimeout(function(){
reject("asdsa");
console.log("reject after")

},1000)


}).catch(e=>{

console.log("catch")
throw e;
})

}

render() {
let { columns, data } = this.state;

    return (
      <Table
        rowKey="id"
        columns={columns}
        validateTrigger="onChange"
        data={data}
        editable={true}
        keyboardNavigation={true}
        alwaysValidate={true}
        isAppend={false}
        allowSaveEmpty={false}
        selectMode={"multiple"}
        checkStrictly={false}
        editTools={['edit', 'add','delete']}
        onEditSave={this.onEditSave.bind(this)}
      />
    );

}
}

}

</Playground>

 
<Playground style={{ height: 400 }}>
 {
  class Demo extends React.Component {

constructor(props) {
super(props);

    const columns = [
      {
        dataIndex: "id",
        title: "id",
        key: "id",
        width: 150
      },
      {
        dataIndex: "column-1",
        title: "column-1",
        width: 100,
          validator: function(value, row) {
            console.log("validator:",row.id,value)
          if (!value) {
            return { valid: false, message: "请输入" };
          }

          return { valid: true, message: "false" };
        },
        editor: function(value, row, index, onchange, ref) {
          return (
            <Input
              defaultValue={value}
              ref={ref}
              onChange={e =>{
               onchange({ "column-1": e.target.value });       
              } }
            />
          );
        }
      },

      {
        dataIndex: "column-2",
        title: "column-2",
        width: 150,
        align: "center",
             validator: function(value, row) {


return new Promise((resolve,reject)=>{

setTimeout(()=>{
console.log("a:",value,row)
if(value>50){
resolve({valid:false,message:"异步验证失败"})

}else{
resolve({valid:true,message:""})

}


},3000)


})


        },
        editor: function(value, row, index, onchange, ref) {
          return (
            <InputNumber
              defaultValue={value}
              ref={ref}
              onChange={e =>{
               onchange({ "column-2": e });       
              } }
            />
          );
        }
      },

      {
        dataIndex: "column-3",
        title: "column-3",
        align: "right"
      },
      {
        dataIndex: "column-4",
        title: "column-4",
        width: 100,
        align: "center"
      }
    ];


    this.state = {
      data: [],
      columns: columns
    };

}

onEditSave(changedRows, newData, type) {
console.log("onEditSave changedRows:", changedRows);
console.log("onEditSave newData:", newData);

this.setState({
data: newData
});
}

onBeforeAdd(){
  console.log("onBeforeAdd:",this.state.data)
  this.setState({
data:  this.state.data.slice()
});
}

render() {
let { columns, data } = this.state;

    return (
      <Table
        rowKey="id"
        columns={columns}
        validateTrigger="onChange"
        data={data}
        isAppend={true}
        editable={true}
        onBeforeAdd2={this.onBeforeAdd.bind(this)}
        allowSaveEmpty={true}
        alwaysValidate={true}
        selectMode={"multiple"}
        checkStrictly={false}
        editTools={['edit', 'add','delete']}
        onEditSave={this.onEditSave.bind(this)}
      />
    );

}
}

}

</Playground>

## 编辑器无边框

> 此模式，只对antd内置的input、datepicker、inputnumber、select生效。若想自定义，可通过自定义样式进行覆盖

<Playground style={{ height: 600 }}>
 {
  class Demo extends React.Component {
  generateData(columns, count = 20, prefix = "Row") {
    return new Array(count).fill(0).map((row, rowIndex) => {
      return columns.reduce(
        (rowData, column, columnIndex) => {
          if (column.dataIndex !== "id") {
            rowData[column.dataIndex] = Math.floor(Math.random() * 100 + 1);
          } else {
            rowData[column.dataIndex] =
              prefix + " " + rowIndex + " - Col " + columnIndex;
          }

          return rowData;
        },
        {
          id: prefix + rowIndex,
          parentId: null
        }
      );
    });

}

constructor(props) {
super(props);

    const columns = [
      {
        dataIndex: "id",
        title: "id",
        key: "id",
        width: 150
      },
      {
        dataIndex: "column-1",
        title: "column-1",
        width: 100,
          validator: function(value, row) {
          if (!value) {
            return { valid: false, message: "请输入" };
          }

          return { valid: true, message: "false" };
        },
        editor: function(value, row, index, onchange, ref) {
          return (
            <Input
              defaultValue={value}
              ref={ref}
              onChange={e => onchange({ ["column-1"]: e.target.value })}
            />
          );
        }
      },

      {
        dataIndex: "column-2",
        title: "column-2",
        width: 150,
        align: "center",
          validator: function(value, row) {
          if (!value) {
            return { valid: false, message: "请输入" };
          }

          return { valid: true, message: "false" };
        },
        editor: function(value, row, index, onchange, ref) {
          return (
            <InputNumber
              defaultValue={value}
              ref={ref}
              onChange={e => onchange({ ["column-2"]: e })}
            />
          );
        }
      },

      {
        dataIndex: "column-3",
        title: "column-3",
        align: "right",
          validator: function(value, row) {
          if (!value) {
            return { valid: false, message: "请输入" };
          }

          return { valid: true, message: "false" };
        },
        editor: function(value, row, index, onchange, ref) {
          return (
            <Select
              defaultValue={value}
              ref={ref}
              onChange={e => onchange({ ["column-3"]: e })}
            />
          );
        }
      },
      {
        dataIndex: "column-4",
        title: "column-4",
        width: 100,
        align: "center",
          validator: function(value, row) {
          if (!value) {
            return { valid: false, message: "请输入" };
          }

          return { valid: true, message: "false" };
        },
        editor: function(value, row, index, onchange, ref) {
          return (
            <DatePicker
              placeholder=""
              ref={ref}
              onChange={e => onchange({ ["column-4"]: e})}
            />
          );
        }
      },
      {
        dataIndex: "column-5",
        title: "column-5",
        width: 100,
        align: "center",
          validator: function(value, row) {
          if (!value) {
            return { valid: false, message: "请输入" };
          }

          return { valid: true, message: "false" };
        },
        editor: function(value, row, index, onchange, ref) {
          return (
            <Switch
              ref={ref}
              onChange={e => onchange({ ["column-5"]: e.target.value })}
            />
          );
        }
      }
    ];

    let data =  this.generateData(columns,10);

     data[1].children =  this.generateData(columns,3,"children-");


    this.state = {
      data: data,
      columns: columns
    };

}

onEditSave(changedRows, newData, type) {
console.log("onEditSave:", newData);
this.setState({
data: newData
});
}

componentDidMount() {
//this.refs.tableRef.api.edit()
}

render() {
let { columns, data } = this.state;

    return (
      <Table
        rowKey="id"
        ref="tableRef"
        columns={columns}
        validateTrigger="onChange"
        data={data}
        editorNoBorder={true}
        editable={true}
        selectMode={"multiple"}
        checkStrictly={false}
        editAll={true}
        editTools={['edit', 'add','delete']}
        onEditSave={this.onEditSave.bind(this)}
      />
    );

}
}

}

</Playground>



## 只读模式

> 只读模式将不显示编辑栏及复选框，也无法进行行选择

<Playground style={{height:400}} >
{
class Demo extends React.PureComponent {

constructor(props) {
super(props);

    this.state = {
        data: [
            {
                id: "1",
                name: "张三",
                age: 20,
                idcard: "512878211145551112",
                remark: "我是张三"
            },
            {
                id: "2",
                name: "李四",
                age: 20,
                idcard: "512878211145551112",
                remark: "我是李四"
            }
        ]
    }


    this.columns = [
        {
            dataIndex: "id",
            title: "编号",
            width: 200,
            validator: (value, row) => {
                            if (!value) {
                                return { valid: false, message: "" }
                            }
                            return { valid: true, message: "" }
                        },
                            editor: (value, row, index, onchange, ref) => {

                return <Input defaultValue={ value } ref={ ref } onChange={ (e) => {
                    let newValue = e.target.value;
                    onchange({ number: newValue });

                } }></Input>
            }

        },
        {
            width: 150,
           dataIndex: "name",
            title: "姓名",
            width: 150,

validator: (value, row) => {

                if (!value) {
                    return { valid: false, message: "" }
                }

                return { valid: true, message: "" }
            },
            editor: (value, row, index, onchange, ref) => {

                return <Input defaultValue={ value } ref={ ref } onChange={ (e) => {
                    let newValue = e.target.value;
                    onchange({ name: newValue });

                } }></Input>
            }
        },
        {
            dataIndex: "age",
            title: "年龄",
            width: 150,

            editor: (value, row, index, onchange, ref) => {

                return <Input defaultValue={ value } ref={ ref } onChange={ (e) => onchange({ age: e.target.value, idcard: e.target.value }) }></Input>
            }

        },
        {
            dataIndex: "idcard",
            title: "身份证",
            width: 150,

            editor: (value, row, index, onchange, ref) => {

                return <Input value={ value } ref={ ref } onChange={ (e) => onchange({ idcard: e.target.value }) }></Input>
            }

        },
        {
            dataIndex: "tel",
            title: "电话号码",
            width: 150,

            editor: (value, row, index, onchange, ref) => {

                return <Input defaultValue={ value } ref={ ref } onChange={ (e) => onchange({ tel: e.target.value }) }></Input>
            }

        },
        {
            dataIndex: "remark",
            title: "备注",
            editor: (value, row, index, onchange, ref) => {
                return <Input value={ value } ref={ ref } disabled={ true } ></Input>
            }

        }
    ]

}

    onEditSave(changedRows, newData, type) {

        this.setState({
            data: newData
        })
    }





    render() {

        let { data, count } = this.state;

        return  <Table
                    editTools={["edit", "add","delete"]}
                    ref="etable"
                    columns={ this.columns }
                    dataSource={ data }
                    defaultAddCount={ 1 }
                    onEditSave={ this.onEditSave.bind(this) }
                    isAppend={ true }
                    alwaysValidate={ true }
                    validateTrigger="onChange"
                    readOnly={true}
                    selectMode="multiple"
                    rowKey="id">
                </Table>
    }

}}

</Playground>

## 数据联动

> 外部数据同表格数据相互联动

<Playground >
{
class Demo extends React.PureComponent {

constructor(props) {
super(props);

    this.state = {
        count: 0,
        data: [
            {
                id: "1",
                name: "张三",
                age: 20,
                idcard: "512878211145551112",
                remark: "我是张三"
            },
            {
                id: "2",
                name: "李四",
                age: 20,
                idcard: "512878211145551112",
                remark: "我是李四"
            }
        ]
    }


    this.columns = [
        {
            dataIndex: "id",
            title: "编号",
            width: 200

        },
        {
            dataIndex: "name",
            title: "姓名",
            width: 150,
            validator: (value, row) => {

                if (!value) {
                    return { valid: false, message: "" }
                }

                return { valid: true, message: "" }
            },
            editor: (value, row, index, onchange, ref) => {

                return <Input value={ value } ref={ ref } onChange={ (e) => {

                    let newValue = e.target.value;

                    row.name = newValue;

                    this.setState({
                        count: newValue
                    }, () => {
                        onchange({ name: newValue, remark: "我是" + newValue })
                    })

                } }></Input>
            }

        },
        {
            dataIndex: "age",
            title: "年龄",
            width: 150,
            validator: (value, row) => {

                if (!value) {
                    return { valid: false, message: "" }
                }

                return { valid: true, message: "" }
            },
            editor: (value, row, index, onchange, ref) => {

                return <Input defaultValue={ value } ref={ ref } onChange={ (e) => onchange({ age: e.target.value, idcard: e.target.value }) }></Input>
            }

        },
        {
            dataIndex: "idcard",
            title: "身份证",
            width: 150,
            validator: (value, row) => {

                if (!value) {
                    return { valid: false, message: "" }
                }

                return { valid: true, message: "" }
            },
            editor: (value, row, index, onchange, ref) => {

                return <Input value={ value } ref={ ref } onChange={ (e) => onchange({ idcard: e.target.value }) }></Input>
            }

        },
        {
            dataIndex: "tel",
            title: "电话号码",
            width: 150,
            validator: (value, row) => {

                if (!value) {
                    return { valid: false, message: "" }
                }

                return { valid: true, message: "" }
            },
            editor: (value, row, index, onchange, ref) => {

                return <Input defaultValue={ value } ref={ ref } onChange={ (e) => onchange({ tel: e.target.value }) }></Input>
            }

        },
        {
            dataIndex: "remark",
            title: "备注",
            editor: (value, row, index, onchange, ref) => {
                return <Input value={ value } ref={ ref } disabled={ true } ></Input>
            }

        }
    ]

}

    onChange (e){

        let value = e.target.value;

        let { data, count } = this.state;

        let newData=[...data];

         newData.forEach(d => {
                d.name = value
            });


        this.setState({
            count: value,
            data:newData
        })


    }

    onEditSave(changedRows, newData, type) {

        this.setState({
            data: newData
        })
    }



    complete() {
        this.refs["etable"].completeEdit();
    }


    render() {

        let { data, count } = this.state;

        return <div >
            <Input value={ count } onChange={ this.onChange.bind(this) } style={ { margin: "10px 0" } }></Input>
            <Button onClick={ this.complete.bind(this) } style={ { margin: "10px 0" } } >完成</Button>
            <div style={ { height: 400 } }>
                <Table
                    ref="etable"
                    columns={ this.columns }
                    dataSource={ data }
                    editable={true}
                    defaultAddCount={ 1 }
                    onEditSave={ this.onEditSave.bind(this) }
                    isAppend={ true }
                    alwaysValidate={ true }
                    validateTrigger="onChange"
                    rowKey="id">
                </Table>
            </div>

        </div>
    }

}}

</Playground>

## 新增多行

<Playground style={{height:400}} >
{
class Demo extends React.PureComponent {

constructor(props) {
super(props);

    this.state = {
        data: [
            {
                id: "1",
                name: "张三",
                age: 20,
                idcard: "512878211145551112",
                remark: "我是张三"
            },
            {
                id: "2",
                name: "李四",
                age: 20,
                idcard: "512878211145551112",
                remark: "我是李四"
            }
        ]
    }


    this.columns = [
        {
            dataIndex: "id",
            title: "编号",
            width: 200

        },
        {
            dataIndex: "name",
            title: "姓名",
            width: 150,
            validator2:(v)=>{
return {valid:!!v,message:"请输入"};
            },
            editor: (value, row, index, onchange, ref) => {

                return <Input defaultValue={ value } ref={ ref } onChange={ (e) => {
                    let newValue = e.target.value;
                    onchange({ name: newValue, remark: "我是" + newValue });
                } }></Input>
            }

        },
        {
            dataIndex: "age",
            title: "年龄",
            width: 150,
            editor: (value, row, index, onchange, ref) => {

                return <Input defaultValue={ value } ref={ ref } onChange={ (e) => onchange({ age: e.target.value, idcard: e.target.value }) }></Input>
            }

        },
        {
            dataIndex: "idcard",
            title: "身份证",
            width: 150,
            editor: (value, row, index, onchange, ref) => {
                return <Input value={ value } ref={ ref } onChange={ (e) => onchange({ idcard: e.target.value }) }></Input>
            }

        },
        {
            dataIndex: "tel",
            title: "电话号码",
            width: 150,
            editor: (value, row, index, onchange, ref) => {
                return <Input defaultValue={ value } ref={ ref } onChange={ (e) => onchange({ tel: e.target.value }) }></Input>
            }

        },
        {
            dataIndex: "remark",
            title: "备注",
            editor: (value, row, index, onchange, ref) => {
                return <Input value={ value } ref={ ref } disabled={ true } ></Input>
            }

        }
    ]

}

    onEditSave(changedRows, newData, type) {
console.log("onEditSave changedRows:",changedRows)
console.log("onEditSave newData:",newData)


        this.setState({
            data: newData
        })
    }

onEditCancel(){
console.log("onEditCancel")
}

add(){

    if (this.refs.etable) {
        this.refs.etable.api.addRows([{},{},{}])
    }
}

    render() {

        let { data, count } = this.state;

        return  <Table
                    ref="etable"
                    columns={ this.columns }
                    dataSource={ data }
                    header={()=><div><Button onClick={this.add.bind(this)} >api.addRows</Button></div>}
                    editable={true}
                    defaultAddCount={ 5 }
                    editTools={["add","edit","delete"]}
                    onEditSave={ this.onEditSave.bind(this) }
                    onCancel={this.onEditCancel}
                    isAppend={ true }
                    allowSaveEmpty={true}
                    alwaysValidate={ true }
                    validateTrigger="onChange"
                    rowKey="id">
                </Table>
    }

}}

</Playground>



## 新增数据时忽略空数据行

<Playground>
{
  
class Demo extends React.Component {
  generateData(columns, count = 20, prefix = "Row") {
    return new Array(count).fill(0).map(function(row, rowIndex) {
      return columns.reduce(
        function(rowData, column, columnIndex) {
          if (column.dataIndex !== "id") {
            rowData[column.dataIndex] = Math.floor(Math.random() * 100 + 1);
          } else {
            rowData[column.dataIndex] = prefix + " " + rowIndex + " - Col " + columnIndex;
          }

          return rowData;
        },
        {
          id: prefix + rowIndex,
          parentId: null
        }
      );
    });
  }

  constructor(props) {
    super(props);

    const columns = [
      {
        dataIndex: "id",
        title: "id",
        key: "id",
        width: 150,
        align: "center"
      },
      {
        dataIndex: "column-1",
        key: "column-1",
        title: "column-1",
        validator: value => {
          if (!value) {
            return {
              valid: false
            };
          } else {
            return {
              valid: true
            };
          }
        },
        editor: (value, row, index, onchange, ref) => {
          return (
            <Input
              defaultValue={value}
              ref={ref}
              onChange={e => onchange({ "column-1": e.target.value })}
            ></Input>
          );
        }
      },

      {
        dataIndex: "column-2",
        key: "column-2",
        title: "column-2",
        width: 150,
        align: "center",
        editor: (value, row, index, onchange, ref) => {
          return (
            <Input
              defaultValue={value}
              ref={ref}
              onChange={e => onchange({ "column-2": e.target.value })}
            ></Input>
          );
        }
      },

      {
        dataIndex: "column-3",
        key: "column-3",
        title: "column-3",
        align: "right"
      },
      {
        dataIndex: "column-4",
        key: "column-4",
        title: "column-4",
        width: 100,
        align: "center"
      }
    ];

    let data = this.generateData(columns, 10);

    this.state = {
      data: data,
      columns: columns,
      current: 1,
      pageSize: 10,
      total: data.length,
      selectedRowKeys: []
    };
  }

  addData() {
    let arr = new Array(5).fill(0).map((d, i) => {
      return {
        id: "addedData-" + i + "-" + new Date().getTime(),
        "column-1": i === 0 ? "" : "value-" + i,
        "column-2": i === 0 ? "" : "value2-" + i,
        "column-3": "value3-" + i
      };
    });

    this.refs.tb.api.addRows(arr, true, false);
  }

  onEditSave(changedRows, newRows, type) {
    this.setState({ data: newRows });
    console.log("onEditSave");
  }

  render() {
    let { columns, data } = this.state;

    return (
        <div style={{ height: 400 }}>
          <Table
            rowKey="id"
            ref="tb"
            editable={true}
            columns={columns}
            selectMode="multiple"
            loading={false}
            data={data}
            onEditSave={this.onEditSave.bind(this)}
            ignoreEmptyRow={true}
            isAppend={true}
            validateTrigger="onChange"
            editTools={[
              "edit",
              "add",
              "delete",
              function() {
                return (
                  <Button onClick={this.addData.bind(this)}>新增数据</Button>
                );
              }.bind(this)
            ]}
          />
        </div>
    );
  }
}
}

</Playground>

## 自定义工具栏

<Playground style={{height:400}} >
{
class Demo extends React.PureComponent {

constructor(props) {
super(props);

    this.state = {
        data: [
            {
                id: "1",
                name: "张三",
                age: 20,
                idcard: "512878211145551112",
                remark: "我是张三"
            },
            {
                id: "2",
                name: "李四",
                age: 20,
                idcard: "512878211145551112",
                remark: "我是李四"
            }
        ]
    }


    this.columns = [
        {
            dataIndex: "id",
            title: "编号",
            width: 200

        },
        {
            dataIndex: "name",
            title: "姓名",
            width: 150,
            editor: (value, row, index, onchange, ref) => {

                return <Input defaultValue={ value } ref={ ref } onChange={ (e) => {
                    let newValue = e.target.value;
                    onchange({ name: newValue, remark: "我是" + newValue });

                } }></Input>
            }

        },
        {
            dataIndex: "age",
            title: "年龄",
            width: 150,

            editor: (value, row, index, onchange, ref) => {

                return <Input defaultValue={ value } ref={ ref } onChange={ (e) => onchange({ age: e.target.value, idcard: e.target.value }) }></Input>
            }

        },
        {
            dataIndex: "idcard",
            title: "身份证",
            width: 150,

            editor: (value, row, index, onchange, ref) => {

                return <Input value={ value } ref={ ref } onChange={ (e) => onchange({ idcard: e.target.value }) }></Input>
            }

        },
        {
            dataIndex: "tel",
            title: "电话号码",
            width: 150,

            editor: (value, row, index, onchange, ref) => {

                return <Input defaultValue={ value } ref={ ref } onChange={ (e) => onchange({ tel: e.target.value }) }></Input>
            }

        },
        {
            dataIndex: "remark",
            title: "备注",
            editor: (value, row, index, onchange, ref) => {
                return <Input value={ value } ref={ ref } disabled={ true } ></Input>
            }

        }
    ]

}

    onEditSave(changedRows, newData, type) {

        this.setState({
            data: newData
        })
    }



    customTools() {
      return <Button>tools传递函数</Button>

    }



    render() {

        let { data, count } = this.state;

        let tools=["add","edit","delete",
        {icon:"message",text:"查看消息",handler:()=>{alert("点击了自定义按钮")}},
        this.customTools
        ]


        return  <Table
                    ref="etable"
                    columns={ this.columns }
                    dataSource={ data }
                    editable={true}
                    defaultAddCount={ 1 }
                    onEditSave={ this.onEditSave.bind(this) }
                    isAppend={ true }
                    alwaysValidate={ true }
                    validateTrigger="onChange"
                    editTools={tools}
                    editToolsConfig={{position:"top",editText: "自定义编辑按钮及图标", editIcon: "message"}}
                    rowKey="id">

</Table>
}

}}

</Playground>


## 自定义编辑

> 使用表格内置的API，使用api自定义编辑与表格内置的编辑按钮组具有不同的行为，请勿混用

<Playground style={{ height: 600 }}>
{
  class Demo extends React.Component {
  constructor(props) {
    super(props);

    this.tableRef = React.createRef();

    this.state = {
      data: [],
      loading: false,
      expandedRowKeys: []
    };

    this.columns = [
      {
        dataIndex: "column-1",
        key: "column-1",
        title: "column-1",
        align: "left",
        halign: "center",
        minWidth: 300,
        onCell: (row, value, index) => {
          return {
            onClick: () => {
              this.beginEdit(row);
            }
          };
        },
        validator: function(value, row) {
          if (!value) {
            return { valid: false, message: "请输入" };
          }

          return { valid: true, message: "false" };
        },
        editor: function(value, row, index, onchange, ref) {
          return (
            <Input
              defaultValue={value}
              ref={ref}
              onChange={e =>
                onchange([
                  { "column-1": e.target.value, id: row.id },
                  { id: "3", address: e.target.value }
                ])
              }
            />
          );
        }
      },
      {
        title: "appellation",
        width: 150,
        halign: "left",
        children: [
          {
            dataIndex: "address",
            title: "name",
            width: 200,
            onCell: (row, value, index) => {
              return {
                onClick: () => {
                  this.beginEdit(row);
                }
              };
            },
            editor: function(value, row, index, onchange, ref) {
              return (
                <Input
                  defaultValue={value}
                  ref={ref}
                  onChange={e => onchange({ address: e.target.value })}
                />
              );
            }
          },
          {
            title: "nick name",
            width: 150,
            children: [
              {
                dataIndex: "id",
                title: "nick-1",
                maxWidth: 300,
                width: 150
              },
              {
                dataIndex: "level",
                title: "level"
              }
            ]
          }
        ]
      },
      {
        dataIndex: "id",
        key: "column-4",
        title: "id"
      }
    ];
  }

  componentDidMount() {
    function createData(level, parentKey, maxLevel, index) {
      if (level > maxLevel) {
        return;
      }

      let l = level;
      let data = [];
      for (let i = 0; i < 3; i++) {
        let k = parentKey + "-" + level + "-" + i;
        let d = {
          id: k,
          "column-1": "Edward King " + k,
          age: 32,
          level: level,
          address: "London, Park Lane no. " + i
        };

        if (i === 2) {
          d.children = createData(l + 1, k, maxLevel, i);
        }

        data.push(d);
      }
      return data;
    }

    function createTreeData() {
      let data = [];
      for (let i = 0; i < 10; i++) {
        let childrens = createData(0, i, 2);
        let d = {
          id: "" + i,
          level: 0,
          "column-1": "Edward King " + i,
          age: i,
          address: "London, Park Lane no. " + i
        };

        if (i % 3 === 0) {
          d.children = childrens;
        }

        data.push(d);
      }

      return data;
    }

    this.setState({
      data: createTreeData()
    });
  }

  beginEdit(row) {
    let arr = [];
    arr.push(row.id);
    this.tableRef.current.api.editRows(arr);
  }

  completeEdit() {
    this.tableRef.current.api.completeEdit();
  }

  cancelEdit() {
    this.tableRef.current.api.cancelEdit();
  }

  insertData() {
    let arr = [];
    arr.push({ id: "inserted-row-" + new Date().getTime() });

    this.tableRef.current.api.insertData({
      data: arr,
      parentKey: "3",
      editing: true,
      prepend: false,
      startIndex: 2
    });

    //this.tableRef.current.api.editAll();
  }

  modifyData() {
    let arr = [];
    arr.push({ id: "inserted-row-" + new Date().getTime() });

    this.tableRef.current.api.modifyData([
      {
        id: "3",
        "column-1": "modifyData-" + new Date().getTime(),
        level: 3
      }
    ]);
  }

  delete() {
    let deleted = this.tableRef.current.api.deleteData();
       this.tableRef.current.api.completeEdit();
    console.log("deleted:",deleted);
  }

  editAll() {
    this.tableRef.current.api.editAll();
  }

  onEditComplete(modified) {
    console.log("onEditComplete:", modified);
  }

   onEditSave(changedRows,newRows,editType) {
    console.log("onEditSave changedRows:", changedRows);
    console.log("onEditSave newRows:", newRows);
    console.log("onEditSave editType:", editType);
  }

  
  getSelections() {
    let r=this.tableRef.current.api.getSelections();

    console.log("getSelections:", r);
  }

  
  getExpanded() {
    let r=this.tableRef.current.api.getExpanded();

    console.log("getExpanded:", r);
  }

  render() {
    return (
      <div style={{ height: "100%" }}>
        <Table
          header={() => {
            return (
              <div>
                <Button
                  onClick={this.completeEdit.bind(this)}
                  style={{ cursor: "pointer" }}
                >
                  complete edit
                </Button>

                <Button
                  onClick={this.cancelEdit.bind(this)}
                  style={{ cursor: "pointer", marginLeft: 10 }}
                >
                  cancel edit
                </Button>

                <Button
                  onClick={this.insertData.bind(this)}
                  style={{ cursor: "pointer", marginLeft: 10 }}
                >
                  insert data
                </Button>

                <Button
                  onClick={this.modifyData.bind(this)}
                  style={{ cursor: "pointer", marginLeft: 10 }}
                >
                  modify data
                </Button>

                <Button
                  onClick={this.delete.bind(this)}
                  style={{ cursor: "pointer", marginLeft: 10 }}
                >
                  delete
                </Button>

                 <Button
                  onClick={this.editAll.bind(this)}
                  style={{ cursor: "pointer", marginLeft: 10 }}
                >
                  edit all
                </Button>

                     <Button
                  onClick={this.getSelections.bind(this)}
                  style={{ cursor: "pointer", marginLeft: 10 }}
                >
                  get selections
                </Button>
 
              </div>
            );
          }}
          editable={true}
          isAppend={true}
          allowSaveEmpty={true}
   
          alwaysValidate={false}
          validateTrigger="onChange"

          ref={this.tableRef}
          rowKey="id"
          onComplete={this.onEditComplete.bind(this)}
          onEditSave={this.onEditSave.bind(this)}
          columns={this.columns}
          selectMode="multiple"
          checkStrictly={false}
          data={this.state.data}
          selectOnRowClick={false}
        />
      </div>
    );
  }
}
}
</Playground>

 
## 大数据量树形数据编辑

> 使用表格内置的API

<Playground style={{ height: 600 }}>
  <Complex />
</Playground>

`js`

```javascript
import React, { Component } from "react";
import { Table, unflatten } from "tablex";
import { Button, Input, Menu, InputNumber } from "antd";
import _ from "lodash";

const { Search } = Input;

let BaseUrl = process.env.DOCZ_BASE || "";

function requestGet(url, options) {
  let xhr = new XMLHttpRequest();
  xhr.open("GET", url, true);

  xhr.onreadystatechange = function() {};

  xhr.onload = function() {
    if (xhr.status == 200) {
      if (typeof options.onSuccess === "function") {
        var res = {};
        if (xhr.responseText) {
          res = JSON.parse(xhr.responseText);
        }
        options.onSuccess(res);
      }
    }
  };

  xhr.onerror = options.onError;

  xhr.send();
}

function createData(level, parentKey, maxLevel, index) {
  if (level > maxLevel) {
    return;
  }

  let l = level;
  let data = [];
  for (let i = 0; i < 5; i++) {
    let k = parentKey + "-" + level + "-" + i;
    let d = {
      id: k,
      name: "Edward King " + k,
      age: 32,
      address: "London, Park Lane no. " + i
    };

    if (i % 2 === 0) {
      d.children = createData(l + 1, k, maxLevel, i);
    }

    data.push(d);
  }
  return data;
}

function createTreeData() {
  let data = [];
  for (let i = 0; i < 100; i++) {
    data.push({
      id: "" + i,
      level: 0,
      name: "Edward King " + i,
      age: 32,
      address: "London, Park Lane no. " + i,
      children: createData(0, i, 4)
    });
  }

  return data;
}

class Demo extends Component {
  columns = [
    {
      dataIndex: "code",
      key: "code",
      title: "编码",
      width: 200
    },
    {
      title: "名称",
      width: 150,
      key: "name",
      dataIndex: "name"
    },
    {
      dataIndex: "description",
      key: "description",
      title: "特征描述",
      width: 150
    },
    {
      dataIndex: "unit",
      key: "unit",
      title: "单位",
      width: 150
    },
    {
      dataIndex: "quantities",
      key: "quantities",
      title: "工程量",
      width: 150,
      editor: (value, record, index, onchange, ref, validate) => {
        return (
          <Input
            defaultValue={value}
            ref={ref}
            onChange={v => {
              onchange({ quantities: v.target.value });
            }}
          />
        );
      }
    },
    {
      dataIndex: "unitPrice",
      key: "unitPrice",
      title: "综合单价",
      width: 150,
      editor: (value, record, index, onchange, ref, validate) => {
        return (
          <InputNumber
            defaultValue={value}
            ref={ref}
            onKeyDown={e => {
              e.stopPropagation();
            }}
            onChange={e => {
              onchange({ unitPrice: e });
            }}
          />
        );
      }
    },
    {
      dataIndex: "totalPrice",
      key: "totalPrice",
      title: "合价",
      width: 150,
      render: (value, row) => {
        let v = row.unitPrice * row.quantities;
        if (isNaN(v)) {
          return "";
        }
        return v;
      }
    },
    {
      dataIndex: "evaluation",
      key: "evaluation",
      title: "暂估价",
      width: 150
    }
  ];

  state = {
    loading: false,
    treeData: []
  };

  getData = () => {
    this.setState({ loading: true });

    let c = 0;
    requestGet(BaseUrl + "/public/data.json", {
      onSuccess: data => {
        data = _.uniqBy(data, d => {
          return d.code;
        });

        let bl = false;

        data.forEach(d => {
          let id = d.code || "";
          let pid = "";
          let len = id.length;
          d.id = id;

          if (len >= 2) {
            let pl = 2;

            if (len % 2 !== 0) {
              pl = 3;
            }

            if (id === "040704") {
              bl = true;
            }

            if (bl === true) {
              pid = "0407";
            } else {
              pid = id.substring(0, len - pl);
            }
          }

          d.pid = pid;
        });

        let treeData = unflatten(data, "id", "pid");

        this.setState({
          loading: false,
          treeData: treeData
        });
      }
    });
  };

  scrollToItem = index => {
    if (this.actions) {
      this.actions.scrollToItem(index, "center");
    }
  };

  expandTo = (depth = 1) => {
    this.actions.expandTo(depth);
  };

  expandAll = () => {
    this.actions.expandAll();
  };
  collapseAll = () => {
    this.actions.collapseAll();
  };

  rowKey = "id";
  deleteRow = row => {
    let rowKey = this.rowKey;
    let key = row[rowKey];
    this.actions.deleteData([key]);
  };

  copiedRow = null;
  copy = row => {
    let rowData = {};

    for (const k in row) {
      if (row.hasOwnProperty(k) && k !== "children") {
        rowData[k] = row[k];
      }
    }
    let str = JSON.stringify(rowData);
    this.copiedRow = JSON.stringify(rowData);

    const input = document.createElement("input");
    document.body.appendChild(input);
    input.setAttribute("value", str);
    input.select();
    if (document.execCommand("copy")) {
      document.execCommand("copy");
    }
    document.body.removeChild(input);
  };

  pasteChildren = targetRow => {
    let rowKey = this.rowKey;

    let copiedRow = this.copiedRow;

    if (copiedRow) {
      let sourceRow = JSON.parse(copiedRow);
      sourceRow[rowKey] = "copied_row_" + sourceRow[rowKey];

      this.actions.insertData({
        data: [sourceRow],
        parentKey: targetRow[rowKey],
        editing: true,
        scrollTo: false
      });

      this.isCut = false;
      this.copiedRow = null;
    }
  };

  isCut = false;
  cut = row => {
    this.copy(row);
    this.isCut = true;
  };

  selectAll = rowData => {
    this.actions.selectToggle(rowData);
  };

  expandToggle = rowData => {
    this.actions.expandToggle(rowData);
  };

  onMenuClick = ({ key, item }) => {
    console.log("key:", item.props.row);

    let actions = {
      del: this.deleteRow,
      copy: this.copy,
      cut: this.cut,
      pasteChildren: this.pasteChildren,
      selectAll: this.selectAll,
      expandToggle: this.expandToggle,
      export: this.export
    };

    let fn = actions[key];
    if (typeof fn === "function") {
      fn(item.props.row);
    }
  };

  searchIndex = -1;
  searchedKey = "";
  onChangeSearch = () => {
    this.searchIndex = 0;
    this.searchedKey = "";
  };

  onSearch = v => {
    if (!v) {
      this.searchIndex = 0;
      this.searchedKey = "";
      this.scrollToItem(-1);
      this.forceUpdate();
      return;
    }

    //先展开所有以便查询定位
    this.expandAll();

    let searchedIndex = -1;
    let searchedKey = "";

    let f = this.actions.findData(d => d.name.indexOf(v) > -1, {
      startIndex: this.searchIndex,
      startRowKey: this.searchedKey,
      focused: true
    });

    if (f) {
      searchedIndex = f.index;
      searchedKey = f.row.id;
    }

    if (searchedIndex > -1) {
      this.searchIndex = searchedIndex + 1;
      this.searchedKey = searchedKey;
    } else {
      this.searchIndex = -1;
      this.searchedKey = "";
    }
  };

  onFilter = v => {
    let { treeData } = this.state;
    if (!v) {
      this.setState({ treeData: treeData.slice() }, this.collapseAll);
      return;
    }

    this.actions.filterData(d => {
      return d.name.indexOf(v) > -1;
    });

    this.expandAll();
  };

  contentMenu = row => {
    let menuItemProps = {
      style: { height: "auto", lineHeight: "normal" },
      row
    };

    return (
      <Menu selectable={false} onClick={this.onMenuClick}>
        <Menu.Item key="del" {...menuItemProps}>
          删除行
        </Menu.Item>
        <Menu.Item key="copy" {...menuItemProps}>
          复制行
        </Menu.Item>
        <Menu.Item key="cut" {...menuItemProps}>
          剪切行
        </Menu.Item>
        <Menu.Item key="pasteChildren" {...menuItemProps}>
          粘贴行(下级)
        </Menu.Item>
        <Menu.Item key="selectAll" {...menuItemProps}>
          全选/全否
        </Menu.Item>
        <Menu.Item key="expandToggle" {...menuItemProps}>
          展开/收缩
        </Menu.Item>
        <Menu.Item key="export" {...menuItemProps}>
          导出
        </Menu.Item>
        <Menu.Item key="print" {...menuItemProps}>
          打印
        </Menu.Item>
      </Menu>
    );
  };

  actions = {};
  componentDidMount() {
    console.log("actions:", this.actions);
  }

  render() {
    return (
      <div style={{ height: "100%" }}>
        <Table
          rowKey="id"
          editable={true}
          ref="tb"
          loading={this.state.loading}
          columns={this.columns}
          selectMode="multiple"
          checkStrictly={false}
          data={this.state.treeData}
          orderNumber={{ resizable: true }}
          contextMenu={this.contentMenu}
          validateTrigger="onChange"
          isAppend={true}
          actions={this.actions}
          header={() => (
            <div>
              <Button onClick={this.getData}>获取数据</Button>
              <Button onClick={this.expandAll} style={{ margin: "0 5px" }}>
                展开所有
              </Button>
              <Button
                onClick={() => this.expandTo(1)}
                style={{ margin: "0 5px" }}
              >
                展开至第二级
              </Button>

              <Button onClick={this.collapseAll}>折叠所有</Button>
              <Search
                style={{ float: "right", margin: "0 5px", width: "150px" }}
                placeholder="输入名称过滤"
                onSearch={this.onFilter}
              />
              <Search
                style={{ float: "right", margin: "0 5px", width: "150px" }}
                placeholder="输入名称查找"
                onSearch={this.onSearch}
                onChange={this.onChangeSearch}
              />
            </div>
          )}
        />
      </div>
    );
  }
}

export default Demo;



```